# ADR-0001: 分层与兼容策略

- 状态：Accepted
- 日期：2026-02-22

## 背景

项目历史上由 `main.py` 集中承担路由、任务编排和状态管理，导致维护成本高、改动冲突频繁、回归风险上升。

## 决策

1. 采用分层结构：`routers -> services -> schemas`
2. 保持 API 路径 100% 兼容，不引入 v2 路径
3. 引入 `TaskRuntime` 统一任务状态/日志/停止标记
4. 路由迁移采用“代理迁移 -> 逻辑下沉”两步法

## 影响

正向：

- 可并行开发，职责边界清晰
- 可逐步迁移，不需要一次性大改

负向：

- 短期会出现“router 代理 legacy handler”的过渡状态
- 文件数量增加，需要更强目录纪律

## 后续

1. 将 `main.py` 剩余领域路由按域搬迁
2. 将代理路由逐步替换为 service 直连实现
3. 收敛历史兼容分支并标注淘汰窗口
